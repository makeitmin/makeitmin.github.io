---
title: 커널 오브젝트에 대한 이해
date: 2021-07-31 16:07:90
category: Computer Science
thumbnail: { thumbnailSrc }
draft: false
---

**커널**

- 모든 운영체제에 존재하는 핵심 모듈
- 커널의 기능을 추가하고 보강한 것이 현대의 운영체제

**커널 오브젝트**

- 커널에 의해 관리되는 리소스 정보를 담고 있는 데이터 블록
- 프로세스 생성 시 구조체의 형태로 함께 생성
- 프로세스의 상태 정보, 우선 순위 정보 저장
- 리소스마다 관리되어야 하는 정보가 다르기 때문에 각기 디자인
- 프로그래머가 직접적으로 접근 불가

**운영체제**

- 사용자의 요청을 받아 리소스를 생성하고 소멸시키고 관리를 담당
- 접근 정보를 보유하여 접근을 허용
- 조회 정보를 보유하여 어디까지 읽었는지 전달

**리소스**

- 모든 리소스는 고유의 커널 오브젝트를 동반

## 커널 오브젝트에의 접근

### 핸들(Handle)

- 프로세스의 커널 오브젝트에 부여된 고유한 정보
- 커널 오브젝트가 가진 정보를 수정하기 위한 간접적인 접근에 필요
- 정수(integer) 자료형 / 핸들(handle) 자료형
- 각 리소스의 핸들을 얻는 방법은 상이

### 우선순위 기반 커널 오브젝트의 프로세스 관리

고속의 CPU에서 출력 결과를 확인하기 위해 실행 속도를 늦추는 방법

1. **sleep 함수**
    - 호출 시 현재 프로세스가 Running 상태에서 Blocked 상태로 전환
    - 다른 프로세스가 대신 실행
2. **Busy Waiting 루프**
    - 호출 시 현재 프로세스가 Running 상태에서 Ready 상태로 전환
    - 호출이 완료되기 이전에도 우선순위에 따라 프로세스 실행 변화
    - 함수 단위의 실행이 아닌 명령어 단위의 실행

## 커널 오브젝트와 핸들의 종속 관계

### 핸들 테이블(Handle Table)

- 프로세스마다 각자의 핸들 테이블 존재
- 특정 프로세스 커널 오브젝트의 핸들 값 다수를 저장하여 각 프로세스 커널에 접근 가능
- 핸들 테이블에 등록된 값을 기반으로 프로세스에서 커널 오브젝트에 접근

### 운영체제 - 커널 오브젝트 간 종속 관계

운영 체제에 종속된 커널 오브젝트는 여러 프로세스에 의해 간접적으로 접근 가능

- 커널 오브젝트가 가진 Usage Count 정보를 통해 해당 커널 오브젝트를 참조하고 있는 프로세스의 개수 확인
- 참조하는 프로세스가 소멸하면 Usage Count 값이 감소
- 커널 오브젝트를 직접 참조하는 자식 프로세스가 소멸하더라도 부모 프로세스는 여전히 해당 커널 오브젝트를 참조 가능 (Usage Count ≠ 0)

### 프로세스 - 핸들 간 종속 관계

핸들은 운영체제(전체)가 아닌 각 프로세스에 종속되어 있기 때문에 프로세스가 서로 상이하면 같은 값 할당 가능

- 프로세스 자기자신의 핸들은 핸들 테이블에 저장하지 않고, Windows 시스템 함수로 고유한 상수값을 호출 (GetCurrentProcess)

## 커널 오브젝트와 Usage Count

### Usage Count의 사용

커널 오브젝트를 참조하는 대상이 하나도 없을 때 소멸시키기

- 자식 프로세스가 소멸하며 종료 코드를 커널 오브젝트의 정보로 저장하면 부모 프로세스가 이를 반환받아 해당 커널 오브젝트의 참조를 중단 가능하고, 이 경우 Usage Count 값이 감소
- 커널 오브젝트는 모든 프로세스가 해당 커널 오브젝트를 참조하지 않겠다고 표명했을 때 (Usage Count=0), 운영체제에 의해 소멸

### CloseHandle 함수의 사용

핸들을 반환하면서 커널 오브젝트의 Usage Count를 감소시키는 기능

- 리소스의 낭비를 막기 위해 사용
- 프로세스가 작업을 끝마치고 return을 통해 종료
- TerminateProcess 함수는 프로세스 강제 종료 요청으로, CloseHandle 함수와 달리 위험성이 존재

## 참고자료

- 뇌를 자극하는 윈도우즈 시스템 프로그래밍 ([도서](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&mallGb=KOR&barcode=9788979144611&orderClick=LEa&Kc=), [강의](https://www.inflearn.com/course/%EC%8B%9C%EC%8A%A4%ED%85%9C-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D))
